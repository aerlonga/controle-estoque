generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum StatusEquipamento {
  NO_DEPOSITO
  FORA_DEPOSITO
  DESCARTADO
}

enum TipoMovimentacao {
  ENTRADA
  SAIDA
}

enum PerfilUsuario {
  USUARIO
  ADMIN
}

model Usuario {
  id             Int           @id @default(autoincrement())
  nome           String
  usuario_rede   String        @unique
  senha_hash     String
  perfil         PerfilUsuario @default(USUARIO)
  status_usuario Int           @default(1)
  created_at     DateTime      @default(now()) @db.Timestamptz(3)

  equipamentos           Equipamento[]          @relation("EquipamentoCadastrado")
  movimentacoes          Movimentacao[]         @relation("MovimentacaoUsuario")
  historico_equipamentos HistoricoEquipamento[] @relation("HistoricoUsuario")

  @@map("usuarios")
}

model Equipamento {
  id           Int               @id @default(autoincrement())
  patrimonio   String?
  nome         String
  modelo       String
  numero_serie String            @unique
  status       StatusEquipamento @default(NO_DEPOSITO)
  local        String?
  usuario_id   Int
  created_at   DateTime          @default(now())
  updated_at   DateTime          @updatedAt

  usuario                Usuario                @relation("EquipamentoCadastrado", fields: [usuario_id], references: [id])
  movimentacoes          Movimentacao[]         @relation("MovimentacaoEquipamento")
  historico_equipamentos HistoricoEquipamento[] @relation("HistoricoEquipamento")

  @@map("equipamentos")
}

model Movimentacao {
  id                Int              @id @default(autoincrement())
  equipamento_id    Int
  tipo              TipoMovimentacao
  data_movimentacao DateTime         @default(now())
  usuario_id        Int
  observacao        String?
  created_at        DateTime         @default(now())

  equipamento Equipamento @relation("MovimentacaoEquipamento", fields: [equipamento_id], references: [id])
  usuario     Usuario     @relation("MovimentacaoUsuario", fields: [usuario_id], references: [id])

  @@map("movimentacoes")
}

model HistoricoEquipamento {
  id             Int      @id @default(autoincrement())
  equipamento_id Int
  usuario_id     Int
  acao           String
  campo_alterado String?
  valor_anterior String?
  valor_novo     String?
  created_at     DateTime @default(now())

  equipamento Equipamento @relation("HistoricoEquipamento", fields: [equipamento_id], references: [id])
  usuario     Usuario     @relation("HistoricoUsuario", fields: [usuario_id], references: [id])

  @@map("historico_equipamentos")
}

model TokenBlacklist {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@map("token_blacklist")
}
